<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CapCutMaker5</title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #2c3e50;
      text-align: center;
    }
    .version {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 20px;
    }
    .content {
      line-height: 1.6;
    }
    .protocol-data {
      margin-top: 20px;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
      word-break: break-all;
    }
    .update-message {
      margin-top: 20px;
      padding: 10px;
      background-color: #e8f4fc;
      border-radius: 4px;
      color: #2980b9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CapCutMaker</h1>
    <div class="version" id="version-info">加载中...</div>
    
    <div class="content">
      <p>这是一个可以通过网页链接启动的Electron应用程序。</p>
      <p>您可以使用以下协议链接来启动此应用：</p>
      <code>capcutmaker://action?param=value</code>
      
      <div id="protocol-data" class="protocol-data">
        <p>协议数据将显示在这里...</p>
      </div>
      
      <div id="update-message" class="update-message">
        <p>更新状态将显示在这里...</p>
      </div>
    </div>
  </div>

  <script>
    // 引入electron的ipcRenderer模块
    const { ipcRenderer } = require('electron');
    
    // 获取版本信息
    function getVersionInfo() {
      const args = process.argv;
      let appVersion = "未知";
      let versionCode = "未知";
      
      for (const arg of args) {
        if (arg.startsWith('--app-version=')) {
          appVersion = arg.split('=')[1];
        } else if (arg.startsWith('--version-code=')) {
          versionCode = arg.split('=')[1];
        }
      }
      
      return { appVersion, versionCode };
    }
    
    // 显示版本信息
    const { appVersion, versionCode } = getVersionInfo();
    document.getElementById('version-info').textContent = `版本 ${appVersion} (版本码: ${versionCode})`;
    
    // 监听来自主进程的协议URL消息
    ipcRenderer.on('protocol-url', (event, url) => {
      console.log('Received protocol URL:', url);
      document.getElementById('protocol-data').innerHTML = `
        <p><strong>收到的协议URL:</strong></p>
        <p>${url}</p>
        <p><strong>解析后的参数:</strong></p>
        <pre>${parseUrlParams(url)}</pre>
      `;
    });
    
    // 监听来自主进程的更新消息
    ipcRenderer.on('update-message', (event, text) => {
      console.log('Update message:', text);
      document.getElementById('update-message').innerHTML = `
        <p><strong>更新状态:</strong></p>
        <p>${text}</p>
      `;
    });
    
    // 解析URL参数的函数
    function parseUrlParams(protocolUrl) {
      try {
        // 移除协议前缀
        const urlWithoutProtocol = protocolUrl.replace('capcutmaker://', '');
        
        // 分离路径和查询参数
        const [path, queryString] = urlWithoutProtocol.split('?');
        
        const result = {
          path: path,
          params: {}
        };
        
        // 解析查询参数
        if (queryString) {
          const params = new URLSearchParams(queryString);
          params.forEach((value, key) => {
            result.params[key] = value;
          });
        }
        
        return JSON.stringify(result, null, 2);
      } catch (error) {
        return `解析错误: ${error.message}`;
      }
    }
  </script>
</body>
</html>